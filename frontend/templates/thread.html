{{define "title"}}/{{ .Thread.Board }}/ - Thread No.{{ .Thread.Id }}{{end}}
{{define "content"}}
    <div class="board-header">
        <h1><a href="/{{ .Thread.Board }}">/{{ .Thread.Board }}/</a></h1>
        <hr>
    </div>

    <div class="thread-header">
        <span class="nav-links">[<a href="/{{ .Thread.Board }}/">Return</a>] [<a href="#">Top</a>] [<a href="#bottom">Bottom</a>]</span>
    </div>

    {{template "error-message" .}}

    <div class="posts-container">
        {{ range $index, $message := .Thread.Messages }}
            {{/* Create variables for conditional values before the dict call */}}
            {{$subject := ""}}
            {{if and $message.Op $.Thread.Title}}
                {{$subject = $.Thread.Title}}
            {{end}}

            {{$buttonText := "Delete Post"}}
            {{if $message.Op}}
                {{$buttonText = "Delete OP & Thread"}}
            {{end}}

            {{/* Now, pass the variables into the dict */}}
            {{template "post" dict 
                "IsOp" $message.Op
                "Board" $.Thread.Board
                "MessageID" $message.Id
                "ThreadID" $.Thread.Id
                "HeaderData" (dict 
                    "MessageID" $message.Id
                    "Subject" $subject
                    "CreatedAt" $message.CreatedAt
                    "Link" (printf "#p%d" $message.Id)
                    "Replies" $message.Replies
                    "ShowDeleteButton" $.User.Admin
                    "DeleteButtonData" (dict 
                        "Action" (printf "/%s/%d/%d/delete" $.Thread.Board $.Thread.Id $message.Id)
                        "ConfirmMessage" (printf "Are you sure you want to delete post No.%d? This cannot be undone." $message.Id)
                        "ButtonText" $buttonText
                    )
                    "ShowReplyLink" $message.Op
                    "ReplyLink" "#reply-form-top"
                )
                "AttachmentData" (dict "Attachments" $message.Attachments)
                "BodyData" (dict "Text" $message.Text)
            }}
        {{ end }}
    </div><!-- End posts-container -->
    <br clear="left"> <!-- Clear floats/inline-blocks -->

    <hr class="post-separator"> <!-- Separator before bottom reply form -->

    <!-- Reply Form (Bottom) -->
     <div class="post-form-container" id="reply-form-bottom">
        <form action="/{{ .Thread.Board }}/{{ .Thread.Id }}" method="post">
             <input type="hidden" name="form_action" value="reply">
             <table class="form-table">
                 <tbody>
                     <tr>
                         <td class="form-label"><label for="text-reply-bottom">Comment:</label></td>
                         <td>
                             <textarea id="text-reply-bottom" name="text" cols="48" rows="4" required maxlength="{{.Validation.MessageTextMaxLen}}"></textarea>
                         </td>
                     </tr>
                     <tr>
                         <td class="form-label"></td>
                         <td><button type="submit">Post</button></td>
                     </tr>
                 </tbody>
             </table>
        </form>
    </div>

    <div id="bottom"></div>
    <hr>
    <span class="nav-links">[<a href="/{{ .Thread.Board }}/">Return</a>] [<a href="#">Top</a>] [<a href="#bottom">Bottom</a>]</span>

    {{template "popup-reply-form" .}}
    {{template "message-preview-template"}}
{{ end }}